{% extends 'base.html' %}
{% load static %}

{% block title %}Assigned Jobs - CRM Portal{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="dashboard-title">Assigned Jobs</h1>
    <p class="dashboard-subtitle">Jobs currently allocated to team members with writer details</p>
</div>

<!-- Statistics Cards -->
<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="stat-card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);">
        <div class="stat-value">{{ total_assigned }}</div>
        <div class="stat-label">Total Assigned</div>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);">
        <div class="stat-value">{{ assigned_jobs|length }}</div>
        <div class="stat-label">Jobs with Writers</div>
    </div>
</div>

<!-- Jobs Table -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title" style="margin: 0;">Allocated Jobs with Writer Details</h2>
    </div>
    <div class="card-body">
        {% if assigned_jobs %}
        <div class="table-container" style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>SL No</th>
                        <th>Job ID</th>
                        <th>Topic</th>
                        <th>Word Count</th>
                        <th>Category</th>
                        <th>Allocated Writer</th>
                        <th>Start Date & Time</th>
                        <th>End Date & Time</th>
                        <th>Deadline</th>
                        <th>Allocated By</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">
                    {% for job in assigned_jobs %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong style="color: var(--primary);">{{ job.masking_id }}</strong></td>
                        <td>
                            <div style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                {{ job.topic|default:"No topic" }}
                            </div>
                        </td>
                        <td><strong>{{ job.word_count|default:"--" }}</strong></td>
                        <td>
                            <span class="status-tag" style="background-color: {% if job.category == 'IT' %}rgba(33, 150, 243, 0.2); color: #2196F3{% elif job.category == 'FINANCE' %}rgba(76, 175, 80, 0.2); color: #4CAF50{% else %}rgba(156, 39, 176, 0.2); color: #9C27B0{% endif %};">
                                {{ job.category|default:"General" }}
                            </span>
                        </td>
                        <td>
                            <div style="font-weight: 600;">{{ job.allocated_to }}</div>
                            <div style="font-size: 0.75rem; opacity: 0.7;">{{ job.allocated_to_email }}</div>
                        </td>
                        <td>
                            {% if job.start_date_time %}
                                <div style="font-weight: 600;">{{ job.start_date_time|date:"d/m/Y" }}</div>
                                <div style="font-size: 0.75rem; opacity: 0.7;">{{ job.start_date_time|date:"H:i" }}</div>
                            {% else %}
                                <span style="opacity: 0.5;">--</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if job.end_date_time %}
                                <div style="font-weight: 600;">{{ job.end_date_time|date:"d/m/Y" }}</div>
                                <div style="font-size: 0.75rem; opacity: 0.7;">{{ job.end_date_time|date:"H:i" }}</div>
                            {% else %}
                                <span style="opacity: 0.5;">--</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if job.deadline %}
                                <div style="font-weight: 600;">{{ job.deadline|date:"d/m/Y" }}</div>
                                <div style="font-size: 0.75rem; opacity: 0.7;">{{ job.deadline|date:"H:i" }}</div>
                            {% else %}
                                <span style="opacity: 0.5;">--</span>
                            {% endif %}
                        </td>
                        <td>
                            <div style="font-size: 0.875rem;">{{ job.allocated_by|default:"N/A" }}</div>
                            {% if job.allocated_at %}
                                <div style="font-size: 0.75rem; opacity: 0.7;">{{ job.allocated_at|timesince }} ago</div>
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-tag" style="background: rgba(76, 175, 80, 0.2); color: #4CAF50;">
                                {{ job.status|default:"Allocated" }}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{% url 'allocator_view_job_details' job.system_id %}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem; text-decoration: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2"/>
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    View
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--text-color); opacity: 0.6;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 1rem; opacity: 0.5;">
                <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76489 14.1003 1.98232 16.07 2.86" stroke="currentColor" stroke-width="2"/>
                <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"/>
            </svg>
            <p style="font-size: 1.1rem; font-weight: 500;">No assigned jobs yet</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .card, .stat-card {
        animation: fadeInUp 0.5s ease-out;
    }
    
    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }
    
    .data-table tbody tr {
        transition: all 0.3s ease;
    }
    
    .data-table tbody tr:hover {
        background-color: var(--hover-bg);
        transform: scale(1.01);
    }
    
    .status-tag {
        display: inline-block;
        padding: 0.375rem 0.75rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: #fff;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(78, 205, 196, 0.3);
    }
</style>
{% endblock %}